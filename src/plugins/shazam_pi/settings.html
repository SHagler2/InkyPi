<div class="form-group">
    <label for="autoRefresh" class="form-label">Auto-Listen Interval</label>
    <select id="autoRefresh" name="autoRefresh" class="form-input">
        <option value="">Off - Manual only</option>
        <option value="0.083">~5 second pause</option>
        <option value="0.166">~10 second pause</option>
        <option value="0.5">~30 second pause</option>
        <option value="1">Every 1 minute</option>
        <option value="2">Every 2 minutes</option>
        <option value="3">Every 3 minutes</option>
        <option value="5">Every 5 minutes</option>
        <option value="10">Every 10 minutes</option>
    </select>
    <small style="display: block; margin-top: 5px; color: #666;">
        How often to automatically listen for music. Click "Update Now" once to start, then it repeats at this interval.
    </small>
</div>

<div class="form-group">
    <label for="recordingDuration" class="form-label">Recording Duration (seconds)</label>
    <input type="number" id="recordingDuration" name="recordingDuration" class="form-input"
           min="5" max="30" step="1" />
    <small style="display: block; margin-top: 5px; color: #666;">
        How long to listen for music each cycle (5-30 seconds)
    </small>
</div>

<div class="form-group">
    <label for="musicConfidence" class="form-label">Music Detection Confidence</label>
    <input type="number" id="musicConfidence" name="musicConfidence" class="form-input"
           min="0.1" max="0.9" step="0.05" />
    <small style="display: block; margin-top: 5px; color: #666;">
        YAMNet confidence threshold (lower = more sensitive, default 0.15)
    </small>
</div>

<div class="form-group">
    <label for="fitMode" class="form-label">Display Mode</label>
    <select id="fitMode" name="fitMode" class="form-input">
        <option value="fit">Fit (Letterbox - Full image visible)</option>
        <option value="fill">Fill (Crop - No black bars)</option>
    </select>
    <small style="display: block; margin-top: 5px; color: #666;">
        Fit: Shows entire album art with black bars if needed<br>
        Fill: Crops edges to fill screen completely
    </small>
</div>

<div class="form-group">
    <label class="form-label" style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
        <input type="checkbox" id="showLetterboxLabel" name="showLetterboxLabel" style="width: 18px; height: 18px; cursor: pointer;" />
        Show Letterbox Label
    </label>
    <small style="display: block; margin-top: 5px; color: #666;">
        Display a rotated text label in the left letterbox bar (Fit mode only)
    </small>
</div>

<div class="form-group" id="letterboxLabelGroup" style="display: none;">
    <label for="letterboxLabel" class="form-label">Label Text</label>
    <input type="text" id="letterboxLabel" name="letterboxLabel" class="form-input"
           placeholder="Now Playing..." />
    <small style="display: block; margin-top: 5px; color: #666;">
        Custom label text. Leave blank for default "Now Playing..."
    </small>
</div>

<div class="form-group">
    <label class="form-label" style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
        <input type="checkbox" id="pixelated" name="pixelated" style="width: 18px; height: 18px; cursor: pointer;" />
        Pixelated Mode (Tuneshine-style)
    </label>
    <small style="display: block; margin-top: 5px; color: #666;">
        Downscales album art to a chunky pixel grid for a retro LED display look
    </small>
</div>

<div class="form-group" id="pixelSizeGroup" style="display: none;">
    <label for="pixelSize" class="form-label">Pixel Grid Size</label>
    <select id="pixelSize" name="pixelSize" class="form-input">
        <option value="32">32x32 (Extra chunky)</option>
        <option value="48">48x48</option>
        <option value="64">64x64 (Tuneshine-style)</option>
        <option value="80">80x80</option>
        <option value="96">96x96 (Fine)</option>
    </select>
    <small style="display: block; margin-top: 5px; color: #666;">
        Lower values = bigger pixels, more retro look
    </small>
</div>

<div class="form-group" id="pixelStyleGroup" style="display: none;">
    <label for="pixelStyle" class="form-label">Pixel Shape</label>
    <select id="pixelStyle" name="pixelStyle" class="form-input">
        <option value="round">Round LEDs (Tuneshine-style)</option>
        <option value="square">Square blocks</option>
    </select>
    <small style="display: block; margin-top: 5px; color: #666;">
        Round draws individual dots with gaps, like a real LED panel
    </small>
</div>

<div class="form-group">
    <label for="weatherApiKey" class="form-label">OpenWeatherMap API Key (optional)</label>
    <input type="text" id="weatherApiKey" name="weatherApiKey" class="form-input"
           placeholder="Auto-detected from Weather plugin if blank" />
    <small style="display: block; margin-top: 5px; color: #666;">
        Leave blank to use the Weather plugin's API key and location
    </small>
</div>

<div class="form-group">
    <label for="geoCoordinates" class="form-label">Geo Coordinates (lat, lon)</label>
    <input type="text" id="geoCoordinates" name="geoCoordinates" class="form-input"
           placeholder="Auto-detected from Weather plugin if blank" />
</div>

<div class="form-group">
    <label for="units" class="form-label">Temperature Units</label>
    <select id="units" name="units" class="form-input">
        <option value="imperial">Imperial (&deg;F)</option>
        <option value="metric">Metric (&deg;C)</option>
    </select>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const $autoRefresh = document.getElementById('autoRefresh');
        const $recordingDuration = document.getElementById('recordingDuration');
        const $musicConfidence = document.getElementById('musicConfidence');
        const $fitMode = document.getElementById('fitMode');
        const $pixelated = document.getElementById('pixelated');
        const $pixelSize = document.getElementById('pixelSize');
        const $pixelSizeGroup = document.getElementById('pixelSizeGroup');
        const $pixelStyle = document.getElementById('pixelStyle');
        const $pixelStyleGroup = document.getElementById('pixelStyleGroup');
        const $showLetterboxLabel = document.getElementById('showLetterboxLabel');
        const $letterboxLabel = document.getElementById('letterboxLabel');
        const $letterboxLabelGroup = document.getElementById('letterboxLabelGroup');
        const $weatherApiKey = document.getElementById('weatherApiKey');
        const $geoCoordinates = document.getElementById('geoCoordinates');
        const $units = document.getElementById('units');

        function togglePixelSizeVisibility() {
            const show = $pixelated.checked ? 'block' : 'none';
            $pixelSizeGroup.style.display = show;
            $pixelStyleGroup.style.display = show;
        }
        $pixelated.addEventListener('change', togglePixelSizeVisibility);

        function toggleLetterboxLabelVisibility() {
            $letterboxLabelGroup.style.display = $showLetterboxLabel.checked ? 'block' : 'none';
        }
        $showLetterboxLabel.addEventListener('change', toggleLetterboxLabelVisibility);

        if (loadPluginSettings) {
            $autoRefresh.value = pluginSettings.autoRefresh || '';
            $recordingDuration.value = pluginSettings.recordingDuration || 8;
            $musicConfidence.value = pluginSettings.musicConfidence || 0.15;
            $fitMode.value = pluginSettings.fitMode || 'fit';
            $pixelated.checked = pluginSettings.pixelated === 'on' || pluginSettings.pixelated === true;
            $pixelSize.value = pluginSettings.pixelSize || '64';
            $pixelStyle.value = pluginSettings.pixelStyle || 'round';
            $showLetterboxLabel.checked = pluginSettings.showLetterboxLabel === 'on' || pluginSettings.showLetterboxLabel === true;
            $letterboxLabel.value = pluginSettings.letterboxLabel || '';
            $weatherApiKey.value = pluginSettings.weatherApiKey || '';
            $geoCoordinates.value = pluginSettings.geoCoordinates || '';
            $units.value = pluginSettings.units || 'imperial';
        } else {
            $autoRefresh.value = '1';
            $recordingDuration.value = 8;
            $musicConfidence.value = 0.15;
            $fitMode.value = 'fit';
            $pixelated.checked = false;
            $pixelSize.value = '64';
            $pixelStyle.value = 'round';
            $showLetterboxLabel.checked = false;
            $letterboxLabel.value = '';
            $weatherApiKey.value = '';
            $geoCoordinates.value = '';
            $units.value = 'imperial';
        }
        togglePixelSizeVisibility();
        toggleLetterboxLabelVisibility();
    });
</script>
